"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _client = _interopRequireDefault(require("@soundworks/plugin-filesystem/client"));

var _client2 = _interopRequireDefault(require("@soundworks/plugin-platform/client"));

var _client3 = _interopRequireDefault(require("@soundworks/plugin-checkin/client"));

var _client4 = _interopRequireDefault(require("@soundworks/plugin-audio-buffer-loader/client"));

var _client5 = _interopRequireDefault(require("@soundworks/plugin-sync/client"));

var _client6 = _interopRequireDefault(require("@soundworks/plugin-scripting/client"));

var _client7 = _interopRequireDefault(require("@soundworks/plugin-logger/client"));

var _devicemotion = _interopRequireDefault(require("@ircam/devicemotion"));

var _index = _interopRequireDefault(require("./modules/index.js"));

var _index2 = _interopRequireDefault(require("./sources/index.js"));

var _Project = _interopRequireDefault(require("./Project.js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// import path from 'path';
class CoMo {
  constructor(soundworksClient, audioContext = null) {
    // expose constructors of available sources and nodes
    this.sources = _index2.default;
    this.modules = _index.default; // register device motion feature

    _client2.default.addFeatureDefinition({
      id: 'devicemotion',
      initialize: async () => {
        const result = await _devicemotion.default.requestPermission();
        this.hasDeviceMotion = result === 'granted' ? true : false; // always return `true` as we don't want to block the application at
        // this point, this must be the application responsibility to display
        // an error message if the client requires `deviceMotion`

        return true;
      }
    });

    this.client = soundworksClient;
    this.client.pluginManager.register('platform', _client2.default, {
      features: [// @note - this syntax is ugly
      ['web-audio', audioContext], ['devicemotion']]
    });
    this.client.pluginManager.register('checkin', _client3.default);
    this.client.pluginManager.register('file-watcher', _client.default);
    this.client.pluginManager.register('scripts-data', _client6.default);
    this.client.pluginManager.register('scripts-audio', _client6.default); // maybe have 2 sync plugins : 1 for audio, 1 for high precision
    // on androids devices, the resolution of the movement time stamp
    // can be really poor (~80ms on samsung A3)
    //

    this.client.pluginManager.register('sync', _client5.default, {
      // getTimeFunction: () => audioContext.currentTime,
      getTimeFunction: () => performance.now() * 0.001
    }, ['platform']);
    this.client.pluginManager.register('logger', _client7.default); // we don't want to block for whatever reason on first screen

    this.client.pluginManager.register('audio-buffer-loader', _client4.default, {
      assetsDomain: this.client.config.env.assetsDomain
    }, ['platform']);
    this.audioContext = audioContext;

    if (audioContext) {
      this.audioMaster = audioContext.destination;
    }
  }

  async init(config) {
    return Promise.resolve(true);
  }

  async start() {
    this.project = new _Project.default(this);
    await this.project.init();
    return Promise.resolve(true);
  }

  configureExperience(experience, enableServices = {}) {
    this.experience = experience;
    this.experience.plugins = {};
    const plugins = [// 'file-watcher', // we don't need that client-side
    'sync', 'platform', 'checkin', 'audio-buffer-loader', 'scripts-data', 'scripts-audio', 'logger'];
    const pluginsRequiringAudioContext = ['platform', 'sync'];
    plugins.forEach(pluginName => {
      if (!(pluginName in enableServices) || enableServices[pluginName] === true) {
        // check plugin that requires the audioContext
        if (pluginsRequiringAudioContext.indexOf(pluginName) !== -1 && this.audioContext === null) {
          throw new Error(`plugin ${pluginName} requires a valid audioContext`);
        }

        this.experience.plugins[pluginName] = this.experience.require(pluginName);
      }
    });
  }

}

var _default = CoMo;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGllbnQvQ29Nby5qcyJdLCJuYW1lcyI6WyJDb01vIiwiY29uc3RydWN0b3IiLCJzb3VuZHdvcmtzQ2xpZW50IiwiYXVkaW9Db250ZXh0Iiwic291cmNlcyIsIm1vZHVsZXMiLCJwbHVnaW5QbGF0Zm9ybUZhY3RvcnkiLCJhZGRGZWF0dXJlRGVmaW5pdGlvbiIsImlkIiwiaW5pdGlhbGl6ZSIsInJlc3VsdCIsImRldmljZW1vdGlvbiIsInJlcXVlc3RQZXJtaXNzaW9uIiwiaGFzRGV2aWNlTW90aW9uIiwiY2xpZW50IiwicGx1Z2luTWFuYWdlciIsInJlZ2lzdGVyIiwiZmVhdHVyZXMiLCJwbHVnaW5DaGVja2luRmFjdG9yeSIsInBsdWdpbkZpbGVTeXN0ZW1GYWN0b3J5IiwicGx1Z2luU2NyaXB0aW5nRmFjdG9yeSIsInBsdWdpblN5bmNGYWN0b3J5IiwiZ2V0VGltZUZ1bmN0aW9uIiwicGVyZm9ybWFuY2UiLCJub3ciLCJwbHVnaW5Mb2dnZXJGYWN0b3J5IiwicGx1Z2luQXVkaW9CdWZmZXJMb2FkZXJGYWN0b3J5IiwiYXNzZXRzRG9tYWluIiwiY29uZmlnIiwiZW52IiwiYXVkaW9NYXN0ZXIiLCJkZXN0aW5hdGlvbiIsImluaXQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInN0YXJ0IiwicHJvamVjdCIsIlByb2plY3QiLCJjb25maWd1cmVFeHBlcmllbmNlIiwiZXhwZXJpZW5jZSIsImVuYWJsZVNlcnZpY2VzIiwicGx1Z2lucyIsInBsdWdpbnNSZXF1aXJpbmdBdWRpb0NvbnRleHQiLCJmb3JFYWNoIiwicGx1Z2luTmFtZSIsImluZGV4T2YiLCJFcnJvciIsInJlcXVpcmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFFQTs7OztBQWRBO0FBZ0JBLE1BQU1BLElBQU4sQ0FBVztBQUNUQyxFQUFBQSxXQUFXLENBQUNDLGdCQUFELEVBQW1C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ZUFQYyxFQVFkLFFBUmMsQ0FBaEI7QUFXQSxVQUFNQyw0QkFBNEIsR0FBRyxDQUNuQyxVQURtQyxFQUVuQyxNQUZtQyxDQUFyQztBQUtBRCxJQUFBQSxPQUFPLENBQUNFLE9BQVIsQ0FBZ0JDLFVBQVUsSUFBSTtBQUM1QixVQUFJLEVBQUVBLFVBQVUsSUFBSUosY0FBaEIsS0FBbUNBLGNBQWMsQ0FBQ0ksVUFBRCxDQUFkLEtBQStCLElBQXRFLEVBQTRFO0FBQzFFO0FBQ0EsWUFDRUYsNEJBQTRCLENBQUNHLE9BQTdCLENBQXFDRCxVQUFyQyxNQUFxRCxDQUFDLENBQXRELElBQ0csS0FBS3pDLFlBQUwsS0FBc0IsSUFGM0IsRUFHRTtBQUNBLGdCQUFNLElBQUkyQyxLQUFKLENBQVcsVUFBU0YsVUFBVyxnQ0FBL0IsQ0FBTjtBQUNEOztBQUVELGFBQUtMLFVBQUwsQ0FBZ0JFLE9BQWhCLENBQXdCRyxVQUF4QixJQUFzQyxLQUFLTCxVQUFMLENBQWdCUSxPQUFoQixDQUF3QkgsVUFBeEIsQ0FBdEM7QUFDRDtBQUNGLEtBWkQ7QUFhRDs7QUF2R1E7O2VBMEdJNUMsSSIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHBsdWdpbkZpbGVTeXN0ZW1GYWN0b3J5IGZyb20gJ0Bzb3VuZHdvcmtzL3BsdWdpbi1maWxlc3lzdGVtL2NsaWVudCc7XG5pbXBvcnQgcGx1Z2luUGxhdGZvcm1GYWN0b3J5IGZyb20gJ0Bzb3VuZHdvcmtzL3BsdWdpbi1wbGF0Zm9ybS9jbGllbnQnO1xuaW1wb3J0IHBsdWdpbkNoZWNraW5GYWN0b3J5IGZyb20gJ0Bzb3VuZHdvcmtzL3BsdWdpbi1jaGVja2luL2NsaWVudCc7XG5pbXBvcnQgcGx1Z2luQXVkaW9CdWZmZXJMb2FkZXJGYWN0b3J5IGZyb20gJ0Bzb3VuZHdvcmtzL3BsdWdpbi1hdWRpby1idWZmZXItbG9hZGVyL2NsaWVudCc7XG5pbXBvcnQgcGx1Z2luU3luY0ZhY3RvcnkgZnJvbSAnQHNvdW5kd29ya3MvcGx1Z2luLXN5bmMvY2xpZW50JztcbmltcG9ydCBwbHVnaW5TY3JpcHRpbmdGYWN0b3J5IGZyb20gJ0Bzb3VuZHdvcmtzL3BsdWdpbi1zY3JpcHRpbmcvY2xpZW50JztcbmltcG9ydCBwbHVnaW5Mb2dnZXJGYWN0b3J5IGZyb20gJ0Bzb3VuZHdvcmtzL3BsdWdpbi1sb2dnZXIvY2xpZW50JztcblxuaW1wb3J0IGRldmljZW1vdGlvbiBmcm9tICdAaXJjYW0vZGV2aWNlbW90aW9uJztcblxuaW1wb3J0IG1vZHVsZXMgZnJvbSAnLi9tb2R1bGVzL2luZGV4LmpzJztcbmltcG9ydCBzb3VyY2VzIGZyb20gJy4vc291cmNlcy9pbmRleC5qcyc7XG5cbmltcG9ydCBQcm9qZWN0IGZyb20gJy4vUHJvamVjdC5qcyc7XG5cbmNsYXNzIENvTW8ge1xuICBjb25zdHJ1Y3Rvcihzb3VuZHdvcmtzQ2xpZW50LCBhdWRpb0NvbnRleHQgPSBudWxsKSB7XG4gICAgLy8gZXhwb3NlIGNvbnN0cnVjdG9ycyBvZiBhdmFpbGFibGUgc291cmNlcyBhbmQgbm9kZXNcbiAgICB0aGlzLnNvdXJjZXMgPSBzb3VyY2VzO1xuICAgIHRoaXMubW9kdWxlcyA9IG1vZHVsZXM7XG5cbiAgICAvLyByZWdpc3RlciBkZXZpY2UgbW90aW9uIGZlYXR1cmVcbiAgICBwbHVnaW5QbGF0Zm9ybUZhY3RvcnkuYWRkRmVhdHVyZURlZmluaXRpb24oe1xuICAgICAgaWQ6ICdkZXZpY2Vtb3Rpb24nLFxuICAgICAgaW5pdGlhbGl6ZTogYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZXZpY2Vtb3Rpb24ucmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgICAgICAgdGhpcy5oYXNEZXZpY2VNb3Rpb24gPSByZXN1bHQgPT09ICdncmFudGVkJyA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgLy8gYWx3YXlzIHJldHVybiBgdHJ1ZWAgYXMgd2UgZG9uJ3Qgd2FudCB0byBibG9jayB0aGUgYXBwbGljYXRpb24gYXRcbiAgICAgICAgLy8gdGhpcyBwb2ludCwgdGhpcyBtdXN0IGJlIHRoZSBhcHBsaWNhdGlvbiByZXNwb25zaWJpbGl0eSB0byBkaXNwbGF5XG4gICAgICAgIC8vIGFuIGVycm9yIG1lc3NhZ2UgaWYgdGhlIGNsaWVudCByZXF1aXJlcyBgZGV2aWNlTW90aW9uYFxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIHRoaXMuY2xpZW50ID0gc291bmR3b3Jrc0NsaWVudDtcblxuICAgIHRoaXMuY2xpZW50LnBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoJ3BsYXRmb3JtJywgcGx1Z2luUGxhdGZvcm1GYWN0b3J5LCB7XG4gICAgICBmZWF0dXJlczogW1xuICAgICAgICAvLyBAbm90ZSAtIHRoaXMgc3ludGF4IGlzIHVnbHlcbiAgICAgICAgWyd3ZWItYXVkaW8nLCBhdWRpb0NvbnRleHRdLFxuICAgICAgICBbJ2RldmljZW1vdGlvbiddXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5jbGllbnQucGx1Z2luTWFuYWdlci5yZWdpc3RlcignY2hlY2tpbicsIHBsdWdpbkNoZWNraW5GYWN0b3J5KTtcbiAgICB0aGlzLmNsaWVudC5wbHVnaW5NYW5hZ2VyLnJlZ2lzdGVyKCdmaWxlLXdhdGNoZXInLCBwbHVnaW5GaWxlU3lzdGVtRmFjdG9yeSk7XG5cblxuICAgIHRoaXMuY2xpZW50LnBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoJ3NjcmlwdHMtZGF0YScsIHBsdWdpblNjcmlwdGluZ0ZhY3RvcnkpO1xuICAgIHRoaXMuY2xpZW50LnBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoJ3NjcmlwdHMtYXVkaW8nLCBwbHVnaW5TY3JpcHRpbmdGYWN0b3J5KTtcblxuICAgIC8vIG1heWJlIGhhdmUgMiBzeW5jIHBsdWdpbnMgOiAxIGZvciBhdWRpbywgMSBmb3IgaGlnaCBwcmVjaXNpb25cbiAgICAvLyBvbiBhbmRyb2lkcyBkZXZpY2VzLCB0aGUgcmVzb2x1dGlvbiBvZiB0aGUgbW92ZW1lbnQgdGltZSBzdGFtcFxuICAgIC8vIGNhbiBiZSByZWFsbHkgcG9vciAofjgwbXMgb24gc2Ftc3VuZyBBMylcbiAgICAvL1xuICAgIHRoaXMuY2xpZW50LnBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoJ3N5bmMnLCBwbHVnaW5TeW5jRmFjdG9yeSwge1xuICAgICAgLy8gZ2V0VGltZUZ1bmN0aW9uOiAoKSA9PiBhdWRpb0NvbnRleHQuY3VycmVudFRpbWUsXG4gICAgICBnZXRUaW1lRnVuY3Rpb246ICgpID0+IHBlcmZvcm1hbmNlLm5vdygpICogMC4wMDEsXG4gICAgfSwgWydwbGF0Zm9ybSddKTtcblxuICAgIHRoaXMuY2xpZW50LnBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoJ2xvZ2dlcicsIHBsdWdpbkxvZ2dlckZhY3RvcnkpO1xuXG4gICAgLy8gd2UgZG9uJ3Qgd2FudCB0byBibG9jayBmb3Igd2hhdGV2ZXIgcmVhc29uIG9uIGZpcnN0IHNjcmVlblxuICAgIHRoaXMuY2xpZW50LnBsdWdpbk1hbmFnZXIucmVnaXN0ZXIoJ2F1ZGlvLWJ1ZmZlci1sb2FkZXInLCBwbHVnaW5BdWRpb0J1ZmZlckxvYWRlckZhY3RvcnksIHtcbiAgICAgIGFzc2V0c0RvbWFpbjogdGhpcy5jbGllbnQuY29uZmlnLmVudi5hc3NldHNEb21haW4sXG4gICAgfSwgWydwbGF0Zm9ybSddKTtcblxuICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gYXVkaW9Db250ZXh0O1xuXG4gICAgaWYgKGF1ZGlvQ29udGV4dCkge1xuICAgICAgdGhpcy5hdWRpb01hc3RlciA9IGF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBpbml0KGNvbmZpZykge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XG4gIH1cblxuICBhc3luYyBzdGFydCgpIHtcbiAgICB0aGlzLnByb2plY3QgPSBuZXcgUHJvamVjdCh0aGlzKTtcbiAgICBhd2FpdCB0aGlzLnByb2plY3QuaW5pdCgpO1xuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZUV4cGVyaWVuY2UoZXhwZXJpZW5jZSwgZW5hYmxlU2VydmljZXMgPSB7fSkge1xuICAgIHRoaXMuZXhwZXJpZW5jZSA9IGV4cGVyaWVuY2U7XG4gICAgdGhpcy5leHBlcmllbmNlLnBsdWdpbnMgPSB7fTtcblxuICAgIGNvbnN0IHBsdWdpbnMgPSBbXG4gICAgICAvLyAnZmlsZS13YXRjaGVyJywgLy8gd2UgZG9uJ3QgbmVlZCB0aGF0IGNsaWVudC1zaWRlXG4gICAgICAnc3luYycsXG4gICAgICAncGxhdGZvcm0nLFxuICAgICAgJ2NoZWNraW4nLFxuICAgICAgJ2F1ZGlvLWJ1ZmZlci1sb2FkZXInLFxuICAgICAgJ3NjcmlwdHMtZGF0YScsXG4gICAgICAnc2NyaXB0cy1hdWRpbycsXG4gICAgICAnbG9nZ2VyJyxcbiAgICBdO1xuXG4gICAgY29uc3QgcGx1Z2luc1JlcXVpcmluZ0F1ZGlvQ29udGV4dCA9IFtcbiAgICAgICdwbGF0Zm9ybScsXG4gICAgICAnc3luYycsXG4gICAgXTtcblxuICAgIHBsdWdpbnMuZm9yRWFjaChwbHVnaW5OYW1lID0+IHtcbiAgICAgIGlmICghKHBsdWdpbk5hbWUgaW4gZW5hYmxlU2VydmljZXMpIHx8IGVuYWJsZVNlcnZpY2VzW3BsdWdpbk5hbWVdID09PSB0cnVlKSB7XG4gICAgICAgIC8vIGNoZWNrIHBsdWdpbiB0aGF0IHJlcXVpcmVzIHRoZSBhdWRpb0NvbnRleHRcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHBsdWdpbnNSZXF1aXJpbmdBdWRpb0NvbnRleHQuaW5kZXhPZihwbHVnaW5OYW1lKSAhPT0gLTFcbiAgICAgICAgICAmJiB0aGlzLmF1ZGlvQ29udGV4dCA9PT0gbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsdWdpbiAke3BsdWdpbk5hbWV9IHJlcXVpcmVzIGEgdmFsaWQgYXVkaW9Db250ZXh0YCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmV4cGVyaWVuY2UucGx1Z2luc1twbHVnaW5OYW1lXSA9IHRoaXMuZXhwZXJpZW5jZS5yZXF1aXJlKHBsdWdpbk5hbWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENvTW87XG5cbiJdfQ==