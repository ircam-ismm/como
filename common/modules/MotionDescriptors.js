"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _BaseModule = _interopRequireDefault(require("./BaseModule.js"));

var _Intensity = _interopRequireDefault(require("../libs/lfo/Intensity"));

var _Orientation = _interopRequireDefault(require("../libs/lfo/Orientation"));

var _Select = _interopRequireDefault(require("../libs/lfo/Select"));

var _EventIn = _interopRequireDefault(require("../libs/lfo/EventIn"));

var _Clip = _interopRequireDefault(require("../libs/lfo/Clip"));

var _Power = _interopRequireDefault(require("../libs/lfo/Power"));

var _Scale = _interopRequireDefault(require("../libs/lfo/Scale"));

var _Multiplier = _interopRequireDefault(require("../libs/lfo/Multiplier"));

var _Biquad = _interopRequireDefault(require("../libs/lfo/Biquad"));

var _Merger = _interopRequireDefault(require("../libs/lfo/Merger"));

var _Bridge = _interopRequireDefault(require("../libs/lfo/Bridge"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// @note - should be replaced at some point

/**
 * @input - Stream[9]
 *   [id, time, period, accX, accY, accZ, gyroAlpha, gyroBeta, gyroGamma]
 * @output - Stream[11] [
 *   intensity
 *   enhancedIntensity
 *   orientation
 *   scaled gyro (deg / ms)
 * ]
 */
class MotionDescriptors extends _BaseModule.default {
  constructor(graph, type, id, options) {
    options = Object.assign({
      resamplingPeriod: 0.02
    }, options);
    super(graph, type, id, options); // @todo - review intensity naming

    this.outputFrame.data.intensity = {
      linear: 0,
      compressed: 0
    };
    this.outputFrame.data.accelerationBandpass5hz = {
      x: 0,
      y: 0,
      z: 0
    };
    this.outputFrame.data.orientation = {
      x: 0,
      y: 0,
      z: 0
    };
    this.outputFrame.data.rotationRateMs = {
      alpha: 0,
      beta: 0,
      gamma: 0
    };
    this.propagate = this.propagate.bind(this);
    this.eventIn = new _EventIn.default({
      frameType: 'vector',
      frameSize: 9,
      frameRate: 1 / this.options.resamplingPeriod
    });
    this.accGyroSelect = new _Select.default({
      indexes: [0, 1, 2, 3, 4, 5]
    });
    this.accSelect = new _Select.default({
      indexes: [0, 1, 2]
    });
    this.gyroSelect = new _Select.default({
      indexes: [3, 4, 5]
    }); // intensity

    this.intensity = new _Intensity.default({
      feedback: 0.7,
      gain: 0.07
    });
    this.intensityNormSelect = new _Select.default({
      index: 0
    }); // boost

    this.intensityClip = new _Clip.default({
      min: 0,
      max: 1
    });
    this.intensityPower = new _Power.default({
      exponent: 0.25
    });
    this.powerClip = new _Clip.default({
      min: 0.15,
      max: 1
    });
    this.powerScale = new _Scale.default({
      inputMin: 0.15,
      inputMax: 1,
      outputMin: 0,
      outputMax: 1
    }); // bandpass

    this.normalizeAcc = new _Multiplier.default({
      factor: 1 / 9.81
    });
    this.bandpass = new _Biquad.default({
      type: 'bandpass',
      q: 1,
      f0: 5
    });
    this.bandpassGain = new _Multiplier.default({
      factor: 1
    }); // orientation filter

    this.orientation = new _Orientation.default(); // gyroscopes scaling

    this.gyroScale = new _Multiplier.default({
      factor: [1 / 1000, 1 / 1000, 1 / 1000]
    }); // merge and output

    this.merger = new _Merger.default({
      frameSizes: [1, 1, 3, 3, 3]
    });
    this.bridge = new _Bridge.default({
      processFrame: this.propagate,
      finalizeStream: this.propagate
    }); // intensity and bandpass

    this.eventIn.connect(this.accSelect); // intensity branch

    this.accSelect.connect(this.intensity);
    this.intensity.connect(this.intensityNormSelect);
    this.intensityNormSelect.connect(this.merger); // boost branch

    this.intensityNormSelect.connect(this.intensityClip);
    this.intensityClip.connect(this.intensityPower);
    this.intensityPower.connect(this.powerClip);
    this.powerClip.connect(this.powerScale);
    this.powerScale.connect(this.merger); // biquad branch

    this.accSelect.connect(this.normalizeAcc);
    this.normalizeAcc.connect(this.bandpass);
    this.bandpass.connect(this.bandpassGain);
    this.bandpassGain.connect(this.merger); // orientation

    this.eventIn.connect(this.accGyroSelect);
    this.accGyroSelect.connect(this.orientation);
    this.orientation.connect(this.merger); // gyroscpes

    this.eventIn.connect(this.gyroSelect);
    this.gyroSelect.connect(this.gyroScale);
    this.gyroScale.connect(this.merger);
    this.merger.connect(this.bridge);
  }

  async init() {
    await this.eventIn.init();
    await this.eventIn.start();
  }

  process(inputFrame) {
    // create a valid lfo frame
    const lfoFrame = {
      time: inputFrame.data.metas.time,
      data: []
    };
    lfoFrame.data[0] = inputFrame.data.accelerationIncludingGravity.x;
    lfoFrame.data[1] = inputFrame.data.accelerationIncludingGravity.y;
    lfoFrame.data[2] = inputFrame.data.accelerationIncludingGravity.z;
    lfoFrame.data[3] = inputFrame.data.rotationRate.alpha;
    lfoFrame.data[4] = inputFrame.data.rotationRate.beta;
    lfoFrame.data[5] = inputFrame.data.rotationRate.gamma; // pipe to lfo graph

    this.eventIn.processFrame(lfoFrame);
  }

  propagate(lfoFrame) {
    this.outputFrame.data.intensity.linear = lfoFrame.data[0];
    this.outputFrame.data.intensity.compressed = lfoFrame.data[1];
    this.outputFrame.data.accelerationBandpass5hz.x = lfoFrame.data[2];
    this.outputFrame.data.accelerationBandpass5hz.y = lfoFrame.data[3];
    this.outputFrame.data.accelerationBandpass5hz.z = lfoFrame.data[4];
    this.outputFrame.data.orientation.x = lfoFrame.data[5];
    this.outputFrame.data.orientation.y = lfoFrame.data[6];
    this.outputFrame.data.orientation.z = lfoFrame.data[7];
    this.outputFrame.data.rotationRateMs.alpha = lfoFrame.data[8];
    this.outputFrame.data.rotationRateMs.beta = lfoFrame.data[9];
    this.outputFrame.data.rotationRateMs.gamma = lfoFrame.data[10];
    super.propagate(this.outputFrame);
  }

}

var _default = MotionDescriptors;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vbW9kdWxlcy9Nb3Rpb25EZXNjcmlwdG9ycy5qcyJdLCJuYW1lcyI6WyJNb3Rpb25EZXNjcmlwdG9ycyIsIkJhc2VNb2R1bGUiLCJjb25zdHJ1Y3RvciIsImdyYXBoIiwidHlwZSIsImlkIiwib3B0aW9ucyIsIk9iamVjdCIsImFzc2lnbiIsInJlc2FtcGxpbmdQZXJpb2QiLCJvdXRwdXRGcmFtZSIsImRhdGEiLCJpbnRlbnNpdHkiLCJsaW5lYXIiLCJjb21wcmVzc2VkIiwiYWNjZWxlcmF0aW9uQmFuZHBhc3M1aHoiLCJ4IiwieSIsInoiLCJvcmllbnRhdGlvbiIsInJvdGF0aW9uUmF0ZU1zIiwiYWxwaGEiLCJiZXRhIiwiZ2FtbWEiLCJwcm9wYWdhdGUiLCJiaW5kIiwiZXZlbnRJbiIsIkV2ZW50SW4iLCJmcmFtZVR5cGUiLCJmcmFtZVNpemUiLCJmcmFtZVJhdGUiLCJhY2NHeXJvU2VsZWN0IiwiU2VsZWN0IiwiaW5kZXhlcyIsImFjY1NlbGVjdCIsImd5cm9TZWxlY3QiLCJJbnRlbnNpdHkiLCJmZWVkYmFjayIsImdhaW4iLCJpbnRlbnNpdHlOb3JtU2VsZWN0IiwiaW5kZXgiLCJpbnRlbnNpdHlDbGlwIiwiQ2xpcCIsIm1pbiIsIm1heCIsImludGVuc2l0eVBvd2VyIiwiUG93ZXIiLCJleHBvbmVudCIsInBvd2VyQ2xpcCIsInBvd2VyU2NhbGUiLCJTY2FsZSIsImlucHV0TWluIiwiaW5wdXRNYXgiLCJvdXRwdXRNaW4iLCJvdXRwdXRNYXgiLCJub3JtYWxpemVBY2MiLCJNdWx0aXBsaWVyIiwiZmFjdG9yIiwiYmFuZHBhc3MiLCJCaXF1YWQiLCJxIiwiZjAiLCJiYW5kcGFzc0dhaW4iLCJPcmllbnRhdGlvbiIsImd5cm9TY2FsZSIsIm1lcmdlciIsIk1lcmdlciIsImZyYW1lU2l6ZXMiLCJicmlkZ2UiLCJCcmlkZ2UiLCJwcm9jZXNzRnJhbWUiLCJmaW5hbGl6ZVN0cmVhbSIsImNvbm5lY3QiLCJpbml0Iiwic3RhcnQiLCJwcm9jZXNzIiwiaW5wdXRGcmFtZSIsImxmb0ZyYW1lIiwidGltZSIsIm1ldGFzIiwiYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eSIsInJvdGF0aW9uUmF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBWEE7O0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxpQkFBTixTQUFnQ0MsbUJBQWhDLENBQTJDO0FBQ3pDQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUUMsSUFBUixFQUFjQyxFQUFkLEVBQWtCQyxPQUFsQixFQUEyQjtBQUNwQ0EsSUFBQUEsT0FBTyxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUFFQyxNQUFBQSxnQkFBZ0IsRUFBRTtBQUFwQixLQUFkLEVBQTBDSCxPQUExQyxDQUFWO0FBRUEsVUFBTUgsS0FBTixFQUFhQyxJQUFiLEVBQW1CQyxFQUFuQixFQUF1QkMsT0FBdkIsRUFIb0MsQ0FLcEM7O0FBQ0EsU0FBS0ksV0FBTCxDQUFpQkMsSUFBakIsQ0FBc0JDLFNBQXRCLEdBQWtDO0FBQUVDLE1BQUFBLE1BQU0sRUFBRSxDQUFWO0FBQWFDLE1BQUFBLFVBQVUsRUFBRTtBQUF6QixLQUFsQztBQUNBLFNBQUtKLFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCSSx1QkFBdEIsR0FBZ0Q7QUFBRUMsTUFBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUUMsTUFBQUEsQ0FBQyxFQUFFLENBQVg7QUFBY0MsTUFBQUEsQ0FBQyxFQUFFO0FBQWpCLEtBQWhEO0FBQ0EsU0FBS1IsV0FBTCxDQUFpQkMsSUFBakIsQ0FBc0JRLFdBQXRCLEdBQW9DO0FBQUVILE1BQUFBLENBQUMsRUFBRSxDQUFMO0FBQVFDLE1BQUFBLENBQUMsRUFBRSxDQUFYO0FBQWNDLE1BQUFBLENBQUMsRUFBRTtBQUFqQixLQUFwQztB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U0FBS0QsV0FBTCxDQUFpQkMsSUFBakIsQ0FBc0JJLHVCQUF0QixDQUE4Q0csQ0FBOUMsR0FBa0QyRCxRQUFRLENBQUNsRSxJQUFULENBQWMsQ0FBZCxDQUFsRDtBQUVBLFNBQUtELFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCUSxXQUF0QixDQUFrQ0gsQ0FBbEMsR0FBc0M2RCxRQUFRLENBQUNsRSxJQUFULENBQWMsQ0FBZCxDQUF0QztBQUNBLFNBQUtELFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCUSxXQUF0QixDQUFrQ0YsQ0FBbEMsR0FBc0M0RCxRQUFRLENBQUNsRSxJQUFULENBQWMsQ0FBZCxDQUF0QztBQUNBLFNBQUtELFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCUSxXQUF0QixDQUFrQ0QsQ0FBbEMsR0FBc0MyRCxRQUFRLENBQUNsRSxJQUFULENBQWMsQ0FBZCxDQUF0QztBQUVBLFNBQUtELFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCUyxjQUF0QixDQUFxQ0MsS0FBckMsR0FBNkN3RCxRQUFRLENBQUNsRSxJQUFULENBQWMsQ0FBZCxDQUE3QztBQUNBLFNBQUtELFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCUyxjQUF0QixDQUFxQ0UsSUFBckMsR0FBNEN1RCxRQUFRLENBQUNsRSxJQUFULENBQWMsQ0FBZCxDQUE1QztBQUNBLFNBQUtELFdBQUwsQ0FBaUJDLElBQWpCLENBQXNCUyxjQUF0QixDQUFxQ0csS0FBckMsR0FBNkNzRCxRQUFRLENBQUNsRSxJQUFULENBQWMsRUFBZCxDQUE3QztBQUVBLFVBQU1hLFNBQU4sQ0FBZ0IsS0FBS2QsV0FBckI7QUFDRDs7QUE1SXdDOztlQStJNUJWLGlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJhc2VNb2R1bGUgZnJvbSAnLi9CYXNlTW9kdWxlLmpzJztcblxuLy8gQG5vdGUgLSBzaG91bGQgYmUgcmVwbGFjZWQgYXQgc29tZSBwb2ludFxuaW1wb3J0IEludGVuc2l0eSBmcm9tICcuLi9saWJzL2xmby9JbnRlbnNpdHknO1xuaW1wb3J0IE9yaWVudGF0aW9uIGZyb20gJy4uL2xpYnMvbGZvL09yaWVudGF0aW9uJztcbmltcG9ydCBTZWxlY3QgZnJvbSAnLi4vbGlicy9sZm8vU2VsZWN0JztcbmltcG9ydCBFdmVudEluIGZyb20gJy4uL2xpYnMvbGZvL0V2ZW50SW4nO1xuaW1wb3J0IENsaXAgZnJvbSAnLi4vbGlicy9sZm8vQ2xpcCc7XG5pbXBvcnQgUG93ZXIgZnJvbSAnLi4vbGlicy9sZm8vUG93ZXInO1xuaW1wb3J0IFNjYWxlIGZyb20gJy4uL2xpYnMvbGZvL1NjYWxlJztcbmltcG9ydCBNdWx0aXBsaWVyIGZyb20gJy4uL2xpYnMvbGZvL011bHRpcGxpZXInO1xuaW1wb3J0IEJpcXVhZCBmcm9tICcuLi9saWJzL2xmby9CaXF1YWQnO1xuaW1wb3J0IE1lcmdlciBmcm9tICcuLi9saWJzL2xmby9NZXJnZXInO1xuaW1wb3J0IEJyaWRnZSBmcm9tICcuLi9saWJzL2xmby9CcmlkZ2UnO1xuXG5cbi8qKlxuICogQGlucHV0IC0gU3RyZWFtWzldXG4gKiAgIFtpZCwgdGltZSwgcGVyaW9kLCBhY2NYLCBhY2NZLCBhY2NaLCBneXJvQWxwaGEsIGd5cm9CZXRhLCBneXJvR2FtbWFdXG4gKiBAb3V0cHV0IC0gU3RyZWFtWzExXSBbXG4gKiAgIGludGVuc2l0eVxuICogICBlbmhhbmNlZEludGVuc2l0eVxuICogICBvcmllbnRhdGlvblxuICogICBzY2FsZWQgZ3lybyAoZGVnIC8gbXMpXG4gKiBdXG4gKi9cbmNsYXNzIE1vdGlvbkRlc2NyaXB0b3JzIGV4dGVuZHMgQmFzZU1vZHVsZSB7XG4gIGNvbnN0cnVjdG9yKGdyYXBoLCB0eXBlLCBpZCwgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgcmVzYW1wbGluZ1BlcmlvZDogMC4wMiB9LCBvcHRpb25zKTtcblxuICAgIHN1cGVyKGdyYXBoLCB0eXBlLCBpZCwgb3B0aW9ucyk7XG5cbiAgICAvLyBAdG9kbyAtIHJldmlldyBpbnRlbnNpdHkgbmFtaW5nXG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLmludGVuc2l0eSA9IHsgbGluZWFyOiAwLCBjb21wcmVzc2VkOiAwIH07XG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLmFjY2VsZXJhdGlvbkJhbmRwYXNzNWh6ID0geyB4OiAwLCB5OiAwLCB6OiAwIH07XG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLm9yaWVudGF0aW9uID0geyB4OiAwLCB5OiAwLCB6OiAwIH07XG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLnJvdGF0aW9uUmF0ZU1zID0geyBhbHBoYTogMCwgYmV0YTogMCwgZ2FtbWE6IDAgfTtcblxuICAgIHRoaXMucHJvcGFnYXRlID0gdGhpcy5wcm9wYWdhdGUuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuZXZlbnRJbiA9IG5ldyBFdmVudEluKHtcbiAgICAgIGZyYW1lVHlwZTogJ3ZlY3RvcicsXG4gICAgICBmcmFtZVNpemU6IDksXG4gICAgICBmcmFtZVJhdGU6IDEgLyB0aGlzLm9wdGlvbnMucmVzYW1wbGluZ1BlcmlvZCxcbiAgICB9KTtcblxuICAgIHRoaXMuYWNjR3lyb1NlbGVjdCA9IG5ldyBTZWxlY3QoeyBpbmRleGVzOiBbMCwgMSwgMiwgMywgNCwgNV0gfSk7XG4gICAgdGhpcy5hY2NTZWxlY3QgPSBuZXcgU2VsZWN0KHsgaW5kZXhlczogWzAsIDEsIDJdIH0pO1xuICAgIHRoaXMuZ3lyb1NlbGVjdCA9IG5ldyBTZWxlY3QoeyBpbmRleGVzOiBbMywgNCwgNV0gfSk7XG5cbiAgICAvLyBpbnRlbnNpdHlcbiAgICB0aGlzLmludGVuc2l0eSA9IG5ldyBJbnRlbnNpdHkoe1xuICAgICAgZmVlZGJhY2s6IDAuNyxcbiAgICAgIGdhaW46IDAuMDcsXG4gICAgfSk7XG5cbiAgICB0aGlzLmludGVuc2l0eU5vcm1TZWxlY3QgPSBuZXcgU2VsZWN0KHsgaW5kZXg6IDAgfSk7XG5cbiAgICAvLyBib29zdFxuICAgIHRoaXMuaW50ZW5zaXR5Q2xpcCA9IG5ldyBDbGlwKHsgbWluOiAwLCBtYXg6IDEgfSk7XG4gICAgdGhpcy5pbnRlbnNpdHlQb3dlciA9IG5ldyBQb3dlcih7IGV4cG9uZW50OiAwLjI1IH0pO1xuICAgIHRoaXMucG93ZXJDbGlwID0gbmV3IENsaXAoeyBtaW46IDAuMTUsIG1heDogMSB9KTtcbiAgICB0aGlzLnBvd2VyU2NhbGUgPSBuZXcgU2NhbGUoe1xuICAgICAgaW5wdXRNaW46IDAuMTUsXG4gICAgICBpbnB1dE1heDogMSxcbiAgICAgIG91dHB1dE1pbjogMCxcbiAgICAgIG91dHB1dE1heDogMSxcbiAgICB9KTtcblxuICAgIC8vIGJhbmRwYXNzXG4gICAgdGhpcy5ub3JtYWxpemVBY2MgPSBuZXcgTXVsdGlwbGllcih7IGZhY3RvcjogMSAvIDkuODEgfSk7XG4gICAgdGhpcy5iYW5kcGFzcyA9IG5ldyBCaXF1YWQoe1xuICAgICAgdHlwZTogJ2JhbmRwYXNzJyxcbiAgICAgIHE6IDEsXG4gICAgICBmMDogNSxcbiAgICB9KTtcblxuICAgIHRoaXMuYmFuZHBhc3NHYWluID0gbmV3IE11bHRpcGxpZXIoeyBmYWN0b3I6IDEgfSk7XG5cbiAgICAvLyBvcmllbnRhdGlvbiBmaWx0ZXJcbiAgICB0aGlzLm9yaWVudGF0aW9uID0gbmV3IE9yaWVudGF0aW9uKCk7XG5cbiAgICAvLyBneXJvc2NvcGVzIHNjYWxpbmdcbiAgICB0aGlzLmd5cm9TY2FsZSA9IG5ldyBNdWx0aXBsaWVyKHtcbiAgICAgIGZhY3RvcjogWzEvMTAwMCwgMS8xMDAwLCAxLzEwMDBdLFxuICAgIH0pO1xuXG4gICAgLy8gbWVyZ2UgYW5kIG91dHB1dFxuICAgIHRoaXMubWVyZ2VyID0gbmV3IE1lcmdlcih7XG4gICAgICBmcmFtZVNpemVzOiBbMSwgMSwgMywgMywgM10sXG4gICAgfSk7XG5cbiAgICB0aGlzLmJyaWRnZSA9IG5ldyBCcmlkZ2Uoe1xuICAgICAgcHJvY2Vzc0ZyYW1lOiB0aGlzLnByb3BhZ2F0ZSxcbiAgICAgIGZpbmFsaXplU3RyZWFtOiB0aGlzLnByb3BhZ2F0ZSxcbiAgICB9KTtcblxuICAgIC8vIGludGVuc2l0eSBhbmQgYmFuZHBhc3NcbiAgICB0aGlzLmV2ZW50SW4uY29ubmVjdCh0aGlzLmFjY1NlbGVjdCk7XG4gICAgLy8gaW50ZW5zaXR5IGJyYW5jaFxuICAgIHRoaXMuYWNjU2VsZWN0LmNvbm5lY3QodGhpcy5pbnRlbnNpdHkpO1xuICAgIHRoaXMuaW50ZW5zaXR5LmNvbm5lY3QodGhpcy5pbnRlbnNpdHlOb3JtU2VsZWN0KTtcbiAgICB0aGlzLmludGVuc2l0eU5vcm1TZWxlY3QuY29ubmVjdCh0aGlzLm1lcmdlcik7XG4gICAgLy8gYm9vc3QgYnJhbmNoXG4gICAgdGhpcy5pbnRlbnNpdHlOb3JtU2VsZWN0LmNvbm5lY3QodGhpcy5pbnRlbnNpdHlDbGlwKTtcbiAgICB0aGlzLmludGVuc2l0eUNsaXAuY29ubmVjdCh0aGlzLmludGVuc2l0eVBvd2VyKTtcbiAgICB0aGlzLmludGVuc2l0eVBvd2VyLmNvbm5lY3QodGhpcy5wb3dlckNsaXApO1xuICAgIHRoaXMucG93ZXJDbGlwLmNvbm5lY3QodGhpcy5wb3dlclNjYWxlKTtcbiAgICB0aGlzLnBvd2VyU2NhbGUuY29ubmVjdCh0aGlzLm1lcmdlcik7XG4gICAgLy8gYmlxdWFkIGJyYW5jaFxuICAgIHRoaXMuYWNjU2VsZWN0LmNvbm5lY3QodGhpcy5ub3JtYWxpemVBY2MpO1xuICAgIHRoaXMubm9ybWFsaXplQWNjLmNvbm5lY3QodGhpcy5iYW5kcGFzcyk7XG4gICAgdGhpcy5iYW5kcGFzcy5jb25uZWN0KHRoaXMuYmFuZHBhc3NHYWluKTtcbiAgICB0aGlzLmJhbmRwYXNzR2Fpbi5jb25uZWN0KHRoaXMubWVyZ2VyKTtcblxuICAgIC8vIG9yaWVudGF0aW9uXG4gICAgdGhpcy5ldmVudEluLmNvbm5lY3QodGhpcy5hY2NHeXJvU2VsZWN0KTtcbiAgICB0aGlzLmFjY0d5cm9TZWxlY3QuY29ubmVjdCh0aGlzLm9yaWVudGF0aW9uKTtcbiAgICB0aGlzLm9yaWVudGF0aW9uLmNvbm5lY3QodGhpcy5tZXJnZXIpO1xuICAgIC8vIGd5cm9zY3Blc1xuICAgIHRoaXMuZXZlbnRJbi5jb25uZWN0KHRoaXMuZ3lyb1NlbGVjdCk7XG4gICAgdGhpcy5neXJvU2VsZWN0LmNvbm5lY3QodGhpcy5neXJvU2NhbGUpO1xuICAgIHRoaXMuZ3lyb1NjYWxlLmNvbm5lY3QodGhpcy5tZXJnZXIpO1xuXG4gICAgdGhpcy5tZXJnZXIuY29ubmVjdCh0aGlzLmJyaWRnZSk7XG4gIH1cblxuICBhc3luYyBpbml0KCkge1xuICAgIGF3YWl0IHRoaXMuZXZlbnRJbi5pbml0KCk7XG4gICAgYXdhaXQgdGhpcy5ldmVudEluLnN0YXJ0KCk7XG4gIH1cblxuICBwcm9jZXNzKGlucHV0RnJhbWUpIHtcbiAgICAvLyBjcmVhdGUgYSB2YWxpZCBsZm8gZnJhbWVcbiAgICBjb25zdCBsZm9GcmFtZSA9IHtcbiAgICAgIHRpbWU6IGlucHV0RnJhbWUuZGF0YS5tZXRhcy50aW1lLFxuICAgICAgZGF0YTogW10sXG4gICAgfTtcblxuICAgIGxmb0ZyYW1lLmRhdGFbMF0gPSBpbnB1dEZyYW1lLmRhdGEuYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eS54O1xuICAgIGxmb0ZyYW1lLmRhdGFbMV0gPSBpbnB1dEZyYW1lLmRhdGEuYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eS55O1xuICAgIGxmb0ZyYW1lLmRhdGFbMl0gPSBpbnB1dEZyYW1lLmRhdGEuYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eS56O1xuICAgIGxmb0ZyYW1lLmRhdGFbM10gPSBpbnB1dEZyYW1lLmRhdGEucm90YXRpb25SYXRlLmFscGhhO1xuICAgIGxmb0ZyYW1lLmRhdGFbNF0gPSBpbnB1dEZyYW1lLmRhdGEucm90YXRpb25SYXRlLmJldGE7XG4gICAgbGZvRnJhbWUuZGF0YVs1XSA9IGlucHV0RnJhbWUuZGF0YS5yb3RhdGlvblJhdGUuZ2FtbWE7XG4gICAgLy8gcGlwZSB0byBsZm8gZ3JhcGhcbiAgICB0aGlzLmV2ZW50SW4ucHJvY2Vzc0ZyYW1lKGxmb0ZyYW1lKTtcbiAgfVxuXG4gIHByb3BhZ2F0ZShsZm9GcmFtZSkge1xuICAgIHRoaXMub3V0cHV0RnJhbWUuZGF0YS5pbnRlbnNpdHkubGluZWFyID0gbGZvRnJhbWUuZGF0YVswXTtcbiAgICB0aGlzLm91dHB1dEZyYW1lLmRhdGEuaW50ZW5zaXR5LmNvbXByZXNzZWQgPSBsZm9GcmFtZS5kYXRhWzFdO1xuXG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLmFjY2VsZXJhdGlvbkJhbmRwYXNzNWh6LnggPSBsZm9GcmFtZS5kYXRhWzJdO1xuICAgIHRoaXMub3V0cHV0RnJhbWUuZGF0YS5hY2NlbGVyYXRpb25CYW5kcGFzczVoei55ID0gbGZvRnJhbWUuZGF0YVszXTtcbiAgICB0aGlzLm91dHB1dEZyYW1lLmRhdGEuYWNjZWxlcmF0aW9uQmFuZHBhc3M1aHoueiA9IGxmb0ZyYW1lLmRhdGFbNF07XG5cbiAgICB0aGlzLm91dHB1dEZyYW1lLmRhdGEub3JpZW50YXRpb24ueCA9IGxmb0ZyYW1lLmRhdGFbNV07XG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLm9yaWVudGF0aW9uLnkgPSBsZm9GcmFtZS5kYXRhWzZdO1xuICAgIHRoaXMub3V0cHV0RnJhbWUuZGF0YS5vcmllbnRhdGlvbi56ID0gbGZvRnJhbWUuZGF0YVs3XTtcblxuICAgIHRoaXMub3V0cHV0RnJhbWUuZGF0YS5yb3RhdGlvblJhdGVNcy5hbHBoYSA9IGxmb0ZyYW1lLmRhdGFbOF07XG4gICAgdGhpcy5vdXRwdXRGcmFtZS5kYXRhLnJvdGF0aW9uUmF0ZU1zLmJldGEgPSBsZm9GcmFtZS5kYXRhWzldO1xuICAgIHRoaXMub3V0cHV0RnJhbWUuZGF0YS5yb3RhdGlvblJhdGVNcy5nYW1tYSA9IGxmb0ZyYW1lLmRhdGFbMTBdO1xuXG4gICAgc3VwZXIucHJvcGFnYXRlKHRoaXMub3V0cHV0RnJhbWUpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1vdGlvbkRlc2NyaXB0b3JzO1xuIl19