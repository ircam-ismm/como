"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _BaseLfo = _interopRequireDefault(require("./BaseLfo.js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const sin = Math.sin;
const cos = Math.cos;
const sqrt = Math.sqrt;
const pow = Math.pow;

const _2PI = Math.PI * 2; // plot (from http://www.earlevel.com/scripts/widgets/20131013/biquads2.js)
// var len = 512;
// var magPlot = [];
// for (var idx = 0; idx < len; idx++) {
//   var w;
//   if (plotType == "linear")
//     w = idx / (len - 1) * Math.PI;  // 0 to pi, linear scale
//   else
//     w = Math.exp(Math.log(1 / 0.001) * idx / (len - 1)) * 0.001 * Math.PI;  // 0.001 to 1, times pi, log scale
//   var phi = Math.pow(Math.sin(w/2), 2);
//   var y = Math.log(Math.pow(a0+a1+a2, 2) - 4*(a0*a1 + 4*a0*a2 + a1*a2)*phi + 16*a0*a2*phi*phi) - Math.log(Math.pow(1+b1+b2, 2) - 4*(b1 + 4*b2 + b1*b2)*phi + 16*b2*phi*phi);
//   y = y * 10 / Math.LN10
//   if (y == -Infinity)
//     y = -200;
//   if (plotType == "linear")
//     magPlot.push([idx / (len - 1) * Fs / 2, y]);
//   else
//     magPlot.push([idx / (len - 1) / 2, y]);
//   if (idx == 0)
//     minVal = maxVal = y;
//   else if (y < minVal)
//     minVal = y;
//   else if (y > maxVal)
//     maxVal = y;
// }


const definitions = {
  type: {
    type: 'enum',
    default: 'lowpass',
    list: ['lowpass', 'highpass', 'bandpass_constant_skirt', 'bandpass', 'bandpass_constant_peak', 'notch', 'allpass', 'peaking', 'lowshelf', 'highshelf'],
    metas: {
      kind: 'dyanmic'
    }
  },
  f0: {
    type: 'float',
    default: 1,
    metas: {
      kind: 'dyanmic'
    }
  },
  gain: {
    type: 'float',
    default: 1,
    min: 0,
    metas: {
      kind: 'dyanmic'
    }
  },
  q: {
    type: 'float',
    default: 1,
    min: 0.001,
    // PIPO_BIQUAD_MIN_Q
    // max: 1,
    metas: {
      kind: 'dyanmic'
    }
  } // bandwidth: {
  //   type: 'float',
  //   default: null,
  //   nullable: true,
  //   metas: { kind: 'dyanmic' },
  // },

};
/**
 * Biquad filter (Direct form I). If input is of type `vector` the filter is
 * applied on each dimension i parallel.
 *
 * Based on the ["Cookbook formulae for audio EQ biquad filter coefficients"](http://www.musicdsp.org/files/Audio-EQ-Cookbook.txt)
 * by Robert Bristow-Johnson.
 *
 * @memberof module:common.operator
 *
 * @param {Object} options - Override default values.
 * @param {String} [options.type='lowpass'] - Type of the filter. Available
 *  filters: 'lowpass', 'highpass', 'bandpass_constant_skirt', 'bandpass_constant_peak'
 *  (alias 'bandpass'), 'notch', 'allpass', 'peaking', 'lowshelf', 'highshelf'.
 * @param {Number} [options.f0=1] - Cutoff or center frequency of the filter
 *  according to its type.
 * @param {Number} [options.gain=1] - Gain of the filter (in dB).
 * @param {Number} [options.q=1] - Quality factor of the filter.
 *
 * @example
 * import * as lfo from 'waves-lfo/client';
 *
 * const audioInBuffer = new lfo.source.AudioInBuffer({
 *   audioBuffer: buffer,
 * });
 *
 * const biquad = new lfo.operator.Biquad({
 *   type: 'lowpass',
 *   f0: 2000,
 *   gain: 3,
 *   q: 12,
 * });
 *
 * const spectrumDisplay = new lfo.sink.SpectrumDisplay({
 *   canvas: '#spectrum',
 * });
 *
 * audioInBuffer.connect(biquad);
 * biquad.connect(spectrumDisplay);
 *
 * audioInBuffer.start();
 */

class Biquad extends _BaseLfo.default {
  constructor(options = {}) {
    super(definitions, options);
  }

  onParamUpdate(name, value, metas) {
    this._calculateCoefs();
  }

  _calculateCoefs() {
    const sampleRate = this.streamParams.sourceSampleRate;
    const frameType = this.streamParams.frameType;
    const frameSize = this.streamParams.frameSize;
    const type = this.params.get('type');
    const f0 = this.params.get('f0');
    const gain = this.params.get('gain');
    const q = this.params.get('q'); // const bandwidth = this.params.get('bandwidth');

    const bandwidth = null;
    let b0 = 0,
        b1 = 0,
        b2 = 0,
        a0 = 0,
        a1 = 0,
        a2 = 0;
    const A = pow(10, gain / 40);
    const w0 = _2PI * f0 / sampleRate;
    const cosW0 = cos(w0);
    const sinW0 = sin(w0);
    let alpha; // depend of the filter type

    let _2RootAAlpha; // intermediate value for lowshelf and highshelf


    switch (type) {
      // H(s) = 1 / (s^2 + s/Q + 1)
      case 'lowpass':
        alpha = sinW0 / (2 * q);
        b0 = (1 - cosW0) / 2;
        b1 = 1 - cosW0;
        b2 = b0;
        a0 = 1 + alpha;
        a1 = -2 * cosW0;
        a2 = 1 - alpha;
        break;
      // H(s) = s^2 / (s^2 + s/Q + 1)

      case 'highpass':
        alpha = sinW0 / (2 * q);
        b0 = (1 + cosW0) / 2;
        b1 = -(1 + cosW0);
        b2 = b0;
        a0 = 1 + alpha;
        a1 = -2 * cosW0;
        a2 = 1 - alpha;
        break;
      // H(s) = s / (s^2 + s/Q + 1)  (constant skirt gain, peak gain = Q)

      case 'bandpass_constant_skirt':
        if (bandwidth) {// sin(w0)*sinh( ln(2)/2 * BW * w0/sin(w0) )           (case: BW)
        } else {
          alpha = sinW0 / (2 * q);
        }

        b0 = sinW0 / 2;
        b1 = 0;
        b2 = -b0;
        a0 = 1 + alpha;
        a1 = -2 * cosW0;
        a2 = 1 - alpha;
        break;
      // H(s) = (s/Q) / (s^2 + s/Q + 1)      (constant 0 dB peak gain)

      case 'bandpass': // looks like what is gnerally considered as a bandpass

      case 'bandpass_constant_peak':
        if (bandwidth) {// sin(w0)*sinh( ln(2)/2 * BW * w0/sin(w0) )           (case: BW)
        } else {
          alpha = sinW0 / (2 * q);
        }

        b0 = alpha;
        b1 = 0;
        b2 = -alpha;
        a0 = 1 + alpha;
        a1 = -2 * cosW0;
        a2 = 1 - alpha;
        break;
      // H(s) = (s^2 + 1) / (s^2 + s/Q + 1)

      case 'notch':
        alpha = sinW0 / (2 * q);
        b0 = 1;
        b1 = -2 * cosW0;
        b2 = 1;
        a0 = 1 + alpha;
        a1 = b1;
        a2 = 1 - alpha;
        break;
      // H(s) = (s^2 - s/Q + 1) / (s^2 + s/Q + 1)

      case 'allpass':
        alpha = sinW0 / (2 * q);
        b0 = 1 - alpha;
        b1 = -2 * cosW0;
        b2 = 1 + alpha;
        a0 = b2;
        a1 = b1;
        a2 = b0;
        break;
      // H(s) = (s^2 + s*(A/Q) + 1) / (s^2 + s/(A*Q) + 1)

      case 'peaking':
        if (bandwidth) {// sin(w0)*sinh( ln(2)/2 * BW * w0/sin(w0) )           (case: BW)
        } else {
          alpha = sinW0 / (2 * q);
        }

        b0 = 1 + alpha * A;
        b1 = -2 * cosW0;
        b2 = 1 - alpha * A;
        a0 = 1 + alpha / A;
        a1 = b1;
        a2 = 1 - alpha / A;
        break;
      // H(s) = A * (s^2 + (sqrt(A)/Q)*s + A)/(A*s^2 + (sqrt(A)/Q)*s + 1)

      case 'lowshelf':
        alpha = sinW0 / (2 * q);
        _2RootAAlpha = 2 * sqrt(A) * alpha;
        b0 = A * (A + 1 - (A - 1) * cosW0 + _2RootAAlpha);
        b1 = 2 * A * (A - 1 - (A + 1) * cosW0);
        b2 = A * (A + 1 - (A - 1) * cosW0 - _2RootAAlpha);
        a0 = A + 1 + (A - 1) * cosW0 + _2RootAAlpha;
        a1 = -2 * (A - 1 + (A + 1) * cosW0);
        a2 = A + 1 + (A - 1) * cosW0 - _2RootAAlpha;
        break;
      // H(s) = A * (A*s^2 + (sqrt(A)/Q)*s + 1)/(s^2 + (sqrt(A)/Q)*s + A)

      case 'highshelf':
        alpha = sinW0 / (2 * q);
        _2RootAAlpha = 2 * sqrt(A) * alpha;
        b0 = A * (A + 1 + (A - 1) * cosW0 + _2RootAAlpha);
        b1 = -2 * A * (A - 1 + (A + 1) * cosW0);
        b2 = A * (A + 1 + (A - 1) * cosW0 - _2RootAAlpha);
        a0 = A + 1 - (A - 1) * cosW0 + _2RootAAlpha;
        a1 = 2 * (A - 1 - (A + 1) * cosW0);
        a2 = A + 1 - (A - 1) * cosW0 - _2RootAAlpha;
        break;
    }

    this.coefs = {
      b0: b0 / a0,
      b1: b1 / a0,
      b2: b2 / a0,
      a1: a1 / a0,
      a2: a2 / a0
    }; // reset state

    if (frameType === 'signal') {
      this.state = {
        x1: 0,
        x2: 0,
        y1: 0,
        y2: 0
      };
    } else {
      this.state = {
        x1: new Float32Array(frameSize),
        x2: new Float32Array(frameSize),
        y1: new Float32Array(frameSize),
        y2: new Float32Array(frameSize)
      };
    }
  }
  /** @private */


  processStreamParams(prevStreamParams) {
    this.prepareStreamParams(prevStreamParams); // if no `sampleRate` or `sampleRate` is 0 we shall halt!

    const sampleRate = this.streamParams.sourceSampleRate;
    console.log(sampleRate);
    if (!sampleRate || sampleRate <= 0) throw new Error('Invalid sampleRate value (0) for biquad');

    this._calculateCoefs();

    this.propagateStreamParams();
  }
  /** @private */


  processVector(frame) {
    const frameSize = this.streamParams.frameSize;
    const outData = this.frame.data;
    const inData = frame.data;
    const state = this.state;
    const coefs = this.coefs;

    for (let i = 0; i < frameSize; i++) {
      const x = inData[i];
      const y = coefs.b0 * x + coefs.b1 * state.x1[i] + coefs.b2 * state.x2[i] - coefs.a1 * state.y1[i] - coefs.a2 * state.y2[i];
      outData[i] = y; // update states

      state.x2[i] = state.x1[i];
      state.x1[i] = x;
      state.y2[i] = state.y1[i];
      state.y1[i] = y;
    }
  }
  /** @private */


  processSignal(frame) {
    const frameSize = this.streamParams.frameSize;
    const outData = this.frame.data;
    const inData = frame.data;
    const state = this.state;
    const coefs = this.coefs;

    for (let i = 0; i < frameSize; i++) {
      const x = inData[i];
      const y = coefs.b0 * x + coefs.b1 * state.x1 + coefs.b2 * state.x2 - coefs.a1 * state.y1 - coefs.a2 * state.y2;
      outData[i] = y; // update states

      state.x2 = state.x1;
      state.x1 = x;
      state.y2 = state.y1;
      state.y1 = y;
    }
  }

}

var _default = Biquad;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vbGlicy9sZm8vQmlxdWFkLmpzIl0sIm5hbWVzIjpbInNpbiIsIk1hdGgiLCJjb3MiLCJzcXJ0IiwicG93IiwiXzJQSSIsIlBJIiwiZGVmaW5pdGlvbnMiLCJ0eXBlIiwiZGVmYXVsdCIsImxpc3QiLCJtZXRhcyIsImtpbmQiLCJmMCIsImdhaW4iLCJtaW4iLCJxIiwiQmlxdWFkIiwiQmFzZUxmbyIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsIm9uUGFyYW1VcGRhdGUiLCJuYW1lIiwidmFsdWUiLCJfY2FsY3VsYXRlQ29lZnMiLCJzYW1wbGVSYXRlIiwic3RyZWFtUGFyYW1zIiwic291cmNlU2FtcGxlUmF0ZSIsImZyYW1lVHlwZSIsImZyYW1lU2l6ZSIsInBhcmFtcyIsImdldCIsImJhbmR3aWR0aCIsImIwIiwiYjEiLCJiMiIsImEwIiwiYTEiLCJhMiIsIkEiLCJ3MCIsImNvc1cwIiwic2luVzAiLCJhbHBoYSIsIl8yUm9vdEFBbHBoYSIsImNvZWZzIiwic3RhdGUiLCJ4MSIsIngyIiwieTEiLCJ5MiIsIkZsb2F0MzJBcnJheSIsInByb2Nlc3NTdHJlYW1QYXJhbXMiLCJwcmV2U3RyZWFtUGFyYW1zIiwicHJlcGFyZVN0cmVhbVBhcmFtcyIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsInByb3BhZ2F0ZVN0cmVhbVBhcmFtcyIsInByb2Nlc3NWZWN0b3IiLCJmcmFtZSIsIm91dERhdGEiLCJkYXRhIiwiaW5EYXRhIiwiaSIsIngiLCJ5IiwicHJvY2Vzc1NpZ25hbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBRUEsTUFBTUEsR0FBRyxHQUFHQyxJQUFJLENBQUNELEdBQWpCO0FBQ0EsTUFBTUUsR0FBRyxHQUFHRCxJQUFJLENBQUNDLEdBQWpCO0FBQ0EsTUFBTUMsSUFBSSxHQUFHRixJQUFJLENBQUNFLElBQWxCO0FBQ0EsTUFBTUMsR0FBRyxHQUFHSCxJQUFJLENBQUNHLEdBQWpCOztBQUNBLE1BQU1DLElB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Q0EsVUFBTUQsS0FBSyxHQUFHLEtBQUtBLEtBQW5COztBQUVBLFNBQUssSUFBSW1CLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUduQyxTQUFwQixFQUErQm1DLENBQUMsRUFBaEMsRUFBb0M7QUFDbEMsWUFBTUMsQ0FBQyxHQUFHRixNQUFNLENBQUNDLENBQUQsQ0FBaEI7QUFDQSxZQUFNRSxDQUFDLEdBQUdyQixLQUFLLENBQUNaLEVBQU4sR0FBV2dDLENBQVgsR0FDQXBCLEtBQUssQ0FBQ1gsRUFBTixHQUFXWSxLQUFLLENBQUNDLEVBRGpCLEdBQ3NCRixLQUFLLENBQUNWLEVBQU4sR0FBV1csS0FBSyxDQUFDRSxFQUR2QyxHQUVBSCxLQUFLLENBQUNSLEVBQU4sR0FBV1MsS0FBSyxDQUFDRyxFQUZqQixHQUVzQkosS0FBSyxDQUFDUCxFQUFOLEdBQVdRLEtBQUssQ0FBQ0ksRUFGakQ7QUFJQVcsTUFBQUEsT0FBTyxDQUFDRyxDQUFELENBQVAsR0FBYUUsQ0FBYixDQU5rQyxDQVFsQzs7QUFDQXBCLE1BQUFBLEtBQUssQ0FBQ0UsRUFBTixHQUFXRixLQUFLLENBQUNDLEVBQWpCO0FBQ0FELE1BQUFBLEtBQUssQ0FBQ0MsRUFBTixHQUFXa0IsQ0FBWDtBQUNBbkIsTUFBQUEsS0FBSyxDQUFDSSxFQUFOLEdBQVdKLEtBQUssQ0FBQ0csRUFBakI7QUFDQUgsTUFBQUEsS0FBSyxDQUFDRyxFQUFOLEdBQVdpQixDQUFYO0FBQ0Q7QUFDRjs7QUFsTzBCOztlQXFPZGpELE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFzZUxmbyBmcm9tICcuL0Jhc2VMZm8uanMnO1xuXG5jb25zdCBzaW4gPSBNYXRoLnNpbjtcbmNvbnN0IGNvcyA9IE1hdGguY29zO1xuY29uc3Qgc3FydCA9IE1hdGguc3FydDtcbmNvbnN0IHBvdyA9IE1hdGgucG93O1xuY29uc3QgXzJQSSA9IE1hdGguUEkgKiAyO1xuXG4vLyBwbG90IChmcm9tIGh0dHA6Ly93d3cuZWFybGV2ZWwuY29tL3NjcmlwdHMvd2lkZ2V0cy8yMDEzMTAxMy9iaXF1YWRzMi5qcylcbi8vIHZhciBsZW4gPSA1MTI7XG4vLyB2YXIgbWFnUGxvdCA9IFtdO1xuLy8gZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgbGVuOyBpZHgrKykge1xuLy8gICB2YXIgdztcbi8vICAgaWYgKHBsb3RUeXBlID09IFwibGluZWFyXCIpXG4vLyAgICAgdyA9IGlkeCAvIChsZW4gLSAxKSAqIE1hdGguUEk7ICAvLyAwIHRvIHBpLCBsaW5lYXIgc2NhbGVcbi8vICAgZWxzZVxuLy8gICAgIHcgPSBNYXRoLmV4cChNYXRoLmxvZygxIC8gMC4wMDEpICogaWR4IC8gKGxlbiAtIDEpKSAqIDAuMDAxICogTWF0aC5QSTsgIC8vIDAuMDAxIHRvIDEsIHRpbWVzIHBpLCBsb2cgc2NhbGVcblxuLy8gICB2YXIgcGhpID0gTWF0aC5wb3coTWF0aC5zaW4ody8yKSwgMik7XG4vLyAgIHZhciB5ID0gTWF0aC5sb2coTWF0aC5wb3coYTArYTErYTIsIDIpIC0gNCooYTAqYTEgKyA0KmEwKmEyICsgYTEqYTIpKnBoaSArIDE2KmEwKmEyKnBoaSpwaGkpIC0gTWF0aC5sb2coTWF0aC5wb3coMStiMStiMiwgMikgLSA0KihiMSArIDQqYjIgKyBiMSpiMikqcGhpICsgMTYqYjIqcGhpKnBoaSk7XG4vLyAgIHkgPSB5ICogMTAgLyBNYXRoLkxOMTBcbi8vICAgaWYgKHkgPT0gLUluZmluaXR5KVxuLy8gICAgIHkgPSAtMjAwO1xuXG4vLyAgIGlmIChwbG90VHlwZSA9PSBcImxpbmVhclwiKVxuLy8gICAgIG1hZ1Bsb3QucHVzaChbaWR4IC8gKGxlbiAtIDEpICogRnMgLyAyLCB5XSk7XG4vLyAgIGVsc2Vcbi8vICAgICBtYWdQbG90LnB1c2goW2lkeCAvIChsZW4gLSAxKSAvIDIsIHldKTtcblxuLy8gICBpZiAoaWR4ID09IDApXG4vLyAgICAgbWluVmFsID0gbWF4VmFsID0geTtcbi8vICAgZWxzZSBpZiAoeSA8IG1pblZhbClcbi8vICAgICBtaW5WYWwgPSB5O1xuLy8gICBlbHNlIGlmICh5ID4gbWF4VmFsKVxuLy8gICAgIG1heFZhbCA9IHk7XG4vLyB9XG5cbmNvbnN0IGRlZmluaXRpb25zID0ge1xuICB0eXBlOiB7XG4gICAgdHlwZTogJ2VudW0nLFxuICAgIGRlZmF1bHQ6ICdsb3dwYXNzJyxcbiAgICBsaXN0OiBbXG4gICAgICAnbG93cGFzcycsXG4gICAgICAnaGlnaHBhc3MnLFxuICAgICAgJ2JhbmRwYXNzX2NvbnN0YW50X3NraXJ0JyxcbiAgICAgICdiYW5kcGFzcycsXG4gICAgICAnYmFuZHBhc3NfY29uc3RhbnRfcGVhaycsXG4gICAgICAnbm90Y2gnLFxuICAgICAgJ2FsbHBhc3MnLFxuICAgICAgJ3BlYWtpbmcnLFxuICAgICAgJ2xvd3NoZWxmJyxcbiAgICAgICdoaWdoc2hlbGYnLFxuICAgIF0sXG4gICAgbWV0YXM6IHsga2luZDogJ2R5YW5taWMnIH0sXG4gIH0sXG4gIGYwOiB7XG4gICAgdHlwZTogJ2Zsb2F0JyxcbiAgICBkZWZhdWx0OiAxLFxuICAgIG1ldGFzOiB7IGtpbmQ6ICdkeWFubWljJyB9LFxuICB9LFxuICBnYWluOiB7XG4gICAgdHlwZTogJ2Zsb2F0JyxcbiAgICBkZWZhdWx0OiAxLFxuICAgIG1pbjogMCxcbiAgICBtZXRhczogeyBraW5kOiAnZHlhbm1pYycgfSxcbiAgfSxcbiAgcToge1xuICAgIHR5cGU6ICdmbG9hdCcsXG4gICAgZGVmYXVsdDogMSxcbiAgICBtaW46IDAuMDAxLCAvLyBQSVBPX0JJUVVBRF9NSU5fUVxuICAgIC8vIG1heDogMSxcbiAgICBtZXRhczogeyBraW5kOiAnZHlhbm1pYycgfSxcbiAgfSxcbiAgLy8gYmFuZHdpZHRoOiB7XG4gIC8vICAgdHlwZTogJ2Zsb2F0JyxcbiAgLy8gICBkZWZhdWx0OiBudWxsLFxuICAvLyAgIG51bGxhYmxlOiB0cnVlLFxuICAvLyAgIG1ldGFzOiB7IGtpbmQ6ICdkeWFubWljJyB9LFxuICAvLyB9LFxufVxuXG5cbi8qKlxuICogQmlxdWFkIGZpbHRlciAoRGlyZWN0IGZvcm0gSSkuIElmIGlucHV0IGlzIG9mIHR5cGUgYHZlY3RvcmAgdGhlIGZpbHRlciBpc1xuICogYXBwbGllZCBvbiBlYWNoIGRpbWVuc2lvbiBpIHBhcmFsbGVsLlxuICpcbiAqIEJhc2VkIG9uIHRoZSBbXCJDb29rYm9vayBmb3JtdWxhZSBmb3IgYXVkaW8gRVEgYmlxdWFkIGZpbHRlciBjb2VmZmljaWVudHNcIl0oaHR0cDovL3d3dy5tdXNpY2RzcC5vcmcvZmlsZXMvQXVkaW8tRVEtQ29va2Jvb2sudHh0KVxuICogYnkgUm9iZXJ0IEJyaXN0b3ctSm9obnNvbi5cbiAqXG4gKiBAbWVtYmVyb2YgbW9kdWxlOmNvbW1vbi5vcGVyYXRvclxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3ZlcnJpZGUgZGVmYXVsdCB2YWx1ZXMuXG4gKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMudHlwZT0nbG93cGFzcyddIC0gVHlwZSBvZiB0aGUgZmlsdGVyLiBBdmFpbGFibGVcbiAqICBmaWx0ZXJzOiAnbG93cGFzcycsICdoaWdocGFzcycsICdiYW5kcGFzc19jb25zdGFudF9za2lydCcsICdiYW5kcGFzc19jb25zdGFudF9wZWFrJ1xuICogIChhbGlhcyAnYmFuZHBhc3MnKSwgJ25vdGNoJywgJ2FsbHBhc3MnLCAncGVha2luZycsICdsb3dzaGVsZicsICdoaWdoc2hlbGYnLlxuICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmYwPTFdIC0gQ3V0b2ZmIG9yIGNlbnRlciBmcmVxdWVuY3kgb2YgdGhlIGZpbHRlclxuICogIGFjY29yZGluZyB0byBpdHMgdHlwZS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5nYWluPTFdIC0gR2FpbiBvZiB0aGUgZmlsdGVyIChpbiBkQikuXG4gKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMucT0xXSAtIFF1YWxpdHkgZmFjdG9yIG9mIHRoZSBmaWx0ZXIuXG4gKlxuICogQGV4YW1wbGVcbiAqIGltcG9ydCAqIGFzIGxmbyBmcm9tICd3YXZlcy1sZm8vY2xpZW50JztcbiAqXG4gKiBjb25zdCBhdWRpb0luQnVmZmVyID0gbmV3IGxmby5zb3VyY2UuQXVkaW9JbkJ1ZmZlcih7XG4gKiAgIGF1ZGlvQnVmZmVyOiBidWZmZXIsXG4gKiB9KTtcbiAqXG4gKiBjb25zdCBiaXF1YWQgPSBuZXcgbGZvLm9wZXJhdG9yLkJpcXVhZCh7XG4gKiAgIHR5cGU6ICdsb3dwYXNzJyxcbiAqICAgZjA6IDIwMDAsXG4gKiAgIGdhaW46IDMsXG4gKiAgIHE6IDEyLFxuICogfSk7XG4gKlxuICogY29uc3Qgc3BlY3RydW1EaXNwbGF5ID0gbmV3IGxmby5zaW5rLlNwZWN0cnVtRGlzcGxheSh7XG4gKiAgIGNhbnZhczogJyNzcGVjdHJ1bScsXG4gKiB9KTtcbiAqXG4gKiBhdWRpb0luQnVmZmVyLmNvbm5lY3QoYmlxdWFkKTtcbiAqIGJpcXVhZC5jb25uZWN0KHNwZWN0cnVtRGlzcGxheSk7XG4gKlxuICogYXVkaW9JbkJ1ZmZlci5zdGFydCgpO1xuICovXG5jbGFzcyBCaXF1YWQgZXh0ZW5kcyBCYXNlTGZvIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgc3VwZXIoZGVmaW5pdGlvbnMsIG9wdGlvbnMpO1xuICB9XG5cbiAgb25QYXJhbVVwZGF0ZShuYW1lLCB2YWx1ZSwgbWV0YXMpIHtcbiAgICB0aGlzLl9jYWxjdWxhdGVDb2VmcygpO1xuICB9XG5cbiAgX2NhbGN1bGF0ZUNvZWZzKCkge1xuICAgIGNvbnN0IHNhbXBsZVJhdGUgPSB0aGlzLnN0cmVhbVBhcmFtcy5zb3VyY2VTYW1wbGVSYXRlO1xuICAgIGNvbnN0IGZyYW1lVHlwZSA9IHRoaXMuc3RyZWFtUGFyYW1zLmZyYW1lVHlwZTtcbiAgICBjb25zdCBmcmFtZVNpemUgPSB0aGlzLnN0cmVhbVBhcmFtcy5mcmFtZVNpemU7XG5cbiAgICBjb25zdCB0eXBlID0gdGhpcy5wYXJhbXMuZ2V0KCd0eXBlJyk7XG4gICAgY29uc3QgZjAgPSB0aGlzLnBhcmFtcy5nZXQoJ2YwJyk7XG4gICAgY29uc3QgZ2FpbiA9IHRoaXMucGFyYW1zLmdldCgnZ2FpbicpO1xuICAgIGNvbnN0IHEgPSB0aGlzLnBhcmFtcy5nZXQoJ3EnKTtcbiAgICAvLyBjb25zdCBiYW5kd2lkdGggPSB0aGlzLnBhcmFtcy5nZXQoJ2JhbmR3aWR0aCcpO1xuICAgIGNvbnN0IGJhbmR3aWR0aCA9IG51bGw7XG5cbiAgICBsZXQgYjAgPSAwLCBiMSA9IDAsIGIyID0gMCwgYTAgPSAwLCBhMSA9IDAsIGEyID0gMDtcblxuICAgIGNvbnN0IEEgPSBwb3coMTAsIGdhaW4gLyA0MCk7XG4gICAgY29uc3QgdzAgPSBfMlBJICogZjAgLyBzYW1wbGVSYXRlO1xuICAgIGNvbnN0IGNvc1cwID0gY29zKHcwKTtcbiAgICBjb25zdCBzaW5XMCA9IHNpbih3MCk7XG4gICAgbGV0IGFscGhhOyAvLyBkZXBlbmQgb2YgdGhlIGZpbHRlciB0eXBlXG4gICAgbGV0IF8yUm9vdEFBbHBoYTsgLy8gaW50ZXJtZWRpYXRlIHZhbHVlIGZvciBsb3dzaGVsZiBhbmQgaGlnaHNoZWxmXG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIC8vIEgocykgPSAxIC8gKHNeMiArIHMvUSArIDEpXG4gICAgICBjYXNlICdsb3dwYXNzJzpcbiAgICAgICAgYWxwaGEgPSBzaW5XMCAvICgyICogcSk7XG4gICAgICAgIGIwID0gKDEgLSBjb3NXMCkgLyAyO1xuICAgICAgICBiMSA9IDEgLSBjb3NXMDtcbiAgICAgICAgYjIgPSBiMDtcbiAgICAgICAgYTAgPSAxICsgYWxwaGE7XG4gICAgICAgIGExID0gLTIgKiBjb3NXMDtcbiAgICAgICAgYTIgPSAxIC1hbHBoYTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBIKHMpID0gc14yIC8gKHNeMiArIHMvUSArIDEpXG4gICAgICBjYXNlICdoaWdocGFzcyc6XG4gICAgICAgIGFscGhhID0gc2luVzAgLyAoMiAqIHEpO1xuICAgICAgICBiMCA9ICgxICsgY29zVzApIC8gMjtcbiAgICAgICAgYjEgPSAtICgxICsgY29zVzApXG4gICAgICAgIGIyID0gYjA7XG4gICAgICAgIGEwID0gMSArIGFscGhhO1xuICAgICAgICBhMSA9IC0yICogY29zVzA7XG4gICAgICAgIGEyID0gMSAtIGFscGhhO1xuICAgICAgICBicmVhaztcbiAgICAgIC8vIEgocykgPSBzIC8gKHNeMiArIHMvUSArIDEpICAoY29uc3RhbnQgc2tpcnQgZ2FpbiwgcGVhayBnYWluID0gUSlcbiAgICAgIGNhc2UgJ2JhbmRwYXNzX2NvbnN0YW50X3NraXJ0JzpcbiAgICAgICAgaWYgKGJhbmR3aWR0aCkge1xuICAgICAgICAgIC8vIHNpbih3MCkqc2luaCggbG4oMikvMiAqIEJXICogdzAvc2luKHcwKSApICAgICAgICAgICAoY2FzZTogQlcpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWxwaGEgPSBzaW5XMCAvICgyICogcSk7XG4gICAgICAgIH1cblxuICAgICAgICBiMCA9IHNpblcwIC8gMjtcbiAgICAgICAgYjEgPSAwO1xuICAgICAgICBiMiA9IC1iMDtcbiAgICAgICAgYTAgPSAxICsgYWxwaGE7XG4gICAgICAgIGExID0gLTIgKiBjb3NXMDtcbiAgICAgICAgYTIgPSAxIC0gYWxwaGE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgLy8gSChzKSA9IChzL1EpIC8gKHNeMiArIHMvUSArIDEpICAgICAgKGNvbnN0YW50IDAgZEIgcGVhayBnYWluKVxuICAgICAgY2FzZSAnYmFuZHBhc3MnOiAvLyBsb29rcyBsaWtlIHdoYXQgaXMgZ25lcmFsbHkgY29uc2lkZXJlZCBhcyBhIGJhbmRwYXNzXG4gICAgICBjYXNlICdiYW5kcGFzc19jb25zdGFudF9wZWFrJzpcbiAgICAgICAgaWYgKGJhbmR3aWR0aCkge1xuICAgICAgICAgIC8vIHNpbih3MCkqc2luaCggbG4oMikvMiAqIEJXICogdzAvc2luKHcwKSApICAgICAgICAgICAoY2FzZTogQlcpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWxwaGEgPSBzaW5XMCAvICgyICogcSk7XG4gICAgICAgIH1cblxuICAgICAgICBiMCA9IGFscGhhO1xuICAgICAgICBiMSA9IDA7XG4gICAgICAgIGIyID0gLWFscGhhO1xuICAgICAgICBhMCA9IDEgKyBhbHBoYTtcbiAgICAgICAgYTEgPSAtMiAqIGNvc1cwO1xuICAgICAgICBhMiA9IDEgLSBhbHBoYTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBIKHMpID0gKHNeMiArIDEpIC8gKHNeMiArIHMvUSArIDEpXG4gICAgICBjYXNlICdub3RjaCc6XG4gICAgICAgIGFscGhhID0gc2luVzAgLyAoMiAqIHEpO1xuICAgICAgICBiMCA9IDE7XG4gICAgICAgIGIxID0gLTIgKiBjb3NXMDtcbiAgICAgICAgYjIgPSAxO1xuICAgICAgICBhMCA9IDEgKyBhbHBoYTtcbiAgICAgICAgYTEgPSBiMTtcbiAgICAgICAgYTIgPSAxIC0gYWxwaGE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgLy8gSChzKSA9IChzXjIgLSBzL1EgKyAxKSAvIChzXjIgKyBzL1EgKyAxKVxuICAgICAgY2FzZSAnYWxscGFzcyc6XG4gICAgICAgIGFscGhhID0gc2luVzAgLyAoMiAqIHEpO1xuICAgICAgICBiMCA9IDEgLSBhbHBoYTtcbiAgICAgICAgYjEgPSAtMiAqIGNvc1cwO1xuICAgICAgICBiMiA9IDEgKyBhbHBoYTtcbiAgICAgICAgYTAgPSBiMjtcbiAgICAgICAgYTEgPSBiMTtcbiAgICAgICAgYTIgPSBiMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvLyBIKHMpID0gKHNeMiArIHMqKEEvUSkgKyAxKSAvIChzXjIgKyBzLyhBKlEpICsgMSlcbiAgICAgIGNhc2UgJ3BlYWtpbmcnOlxuICAgICAgICBpZiAoYmFuZHdpZHRoKSB7XG4gICAgICAgICAgLy8gc2luKHcwKSpzaW5oKCBsbigyKS8yICogQlcgKiB3MC9zaW4odzApICkgICAgICAgICAgIChjYXNlOiBCVylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhbHBoYSA9IHNpblcwIC8gKDIgKiBxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGIwID0gMSArIGFscGhhICogQTtcbiAgICAgICAgYjEgPSAtMiAqIGNvc1cwO1xuICAgICAgICBiMiA9IDEgLSBhbHBoYSAqIEE7XG4gICAgICAgIGEwID0gMSArIGFscGhhIC8gQTtcbiAgICAgICAgYTEgPSBiMTtcbiAgICAgICAgYTIgPSAxIC0gYWxwaGEgLyBBO1xuICAgICAgICBicmVhaztcbiAgICAgIC8vIEgocykgPSBBICogKHNeMiArIChzcXJ0KEEpL1EpKnMgKyBBKS8oQSpzXjIgKyAoc3FydChBKS9RKSpzICsgMSlcbiAgICAgIGNhc2UgJ2xvd3NoZWxmJzpcbiAgICAgICAgYWxwaGEgPSBzaW5XMCAvICgyICogcSk7XG4gICAgICAgIF8yUm9vdEFBbHBoYSA9IDIgKiBzcXJ0KEEpICogYWxwaGE7XG5cbiAgICAgICAgYjAgPSAgICAgQSAqICgoQSArIDEpIC0gKEEgLSAxKSAqIGNvc1cwICsgXzJSb290QUFscGhhKTtcbiAgICAgICAgYjEgPSAyICogQSAqICgoQSAtIDEpIC0gKEEgKyAxKSAqIGNvc1cwKTtcbiAgICAgICAgYjIgPSAgICAgQSAqICgoQSArIDEpIC0gKEEgLSAxKSAqIGNvc1cwIC0gXzJSb290QUFscGhhKTtcbiAgICAgICAgYTAgPSAgICAgICAgICAoQSArIDEpICsgKEEgLSAxKSAqIGNvc1cwICsgXzJSb290QUFscGhhO1xuICAgICAgICBhMSA9ICAgIC0yICogKChBIC0gMSkgKyAoQSArIDEpICogY29zVzApO1xuICAgICAgICBhMiA9ICAgICAgICAgIChBICsgMSkgKyAoQSAtIDEpICogY29zVzAgLSBfMlJvb3RBQWxwaGE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgLy8gSChzKSA9IEEgKiAoQSpzXjIgKyAoc3FydChBKS9RKSpzICsgMSkvKHNeMiArIChzcXJ0KEEpL1EpKnMgKyBBKVxuICAgICAgY2FzZSAnaGlnaHNoZWxmJzpcbiAgICAgICAgYWxwaGEgPSBzaW5XMCAvICgyICogcSk7XG4gICAgICAgIF8yUm9vdEFBbHBoYSA9IDIgKiBzcXJ0KEEpICogYWxwaGE7XG5cbiAgICAgICAgYjAgPSAgICAgIEEgKiAoKEEgKyAxKSArIChBIC0gMSkgKiBjb3NXMCArIF8yUm9vdEFBbHBoYSk7XG4gICAgICAgIGIxID0gLTIgKiBBICogKChBIC0gMSkgKyAoQSArIDEpICogY29zVzApO1xuICAgICAgICBiMiA9ICAgICAgQSAqICgoQSArIDEpICsgKEEgLSAxKSAqIGNvc1cwIC0gXzJSb290QUFscGhhKTtcbiAgICAgICAgYTAgPSAgICAgICAgICAgKEEgKyAxKSAtIChBIC0gMSkgKiBjb3NXMCArIF8yUm9vdEFBbHBoYTtcbiAgICAgICAgYTEgPSAgICAgIDIgKiAoKEEgLSAxKSAtIChBICsgMSkgKiBjb3NXMCk7XG4gICAgICAgIGEyID0gICAgICAgICAgIChBICsgMSkgLSAoQSAtIDEpICogY29zVzAgLSBfMlJvb3RBQWxwaGE7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgdGhpcy5jb2VmcyA9IHtcbiAgICAgIGIwOiBiMCAvIGEwLFxuICAgICAgYjE6IGIxIC8gYTAsXG4gICAgICBiMjogYjIgLyBhMCxcbiAgICAgIGExOiBhMSAvIGEwLFxuICAgICAgYTI6IGEyIC8gYTAsXG4gICAgfTtcblxuICAgIC8vIHJlc2V0IHN0YXRlXG4gICAgaWYgKGZyYW1lVHlwZSA9PT0gJ3NpZ25hbCcpIHtcbiAgICAgIHRoaXMuc3RhdGUgPSB7IHgxOiAwLCB4MjogMCwgeTE6IDAsIHkyOiAwIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgIHgxOiBuZXcgRmxvYXQzMkFycmF5KGZyYW1lU2l6ZSksXG4gICAgICAgIHgyOiBuZXcgRmxvYXQzMkFycmF5KGZyYW1lU2l6ZSksXG4gICAgICAgIHkxOiBuZXcgRmxvYXQzMkFycmF5KGZyYW1lU2l6ZSksXG4gICAgICAgIHkyOiBuZXcgRmxvYXQzMkFycmF5KGZyYW1lU2l6ZSksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBwcm9jZXNzU3RyZWFtUGFyYW1zKHByZXZTdHJlYW1QYXJhbXMpIHtcbiAgICB0aGlzLnByZXBhcmVTdHJlYW1QYXJhbXMocHJldlN0cmVhbVBhcmFtcyk7XG5cbiAgICAvLyBpZiBubyBgc2FtcGxlUmF0ZWAgb3IgYHNhbXBsZVJhdGVgIGlzIDAgd2Ugc2hhbGwgaGFsdCFcbiAgICBjb25zdCBzYW1wbGVSYXRlID0gdGhpcy5zdHJlYW1QYXJhbXMuc291cmNlU2FtcGxlUmF0ZTtcbiAgICBjb25zb2xlLmxvZyhzYW1wbGVSYXRlKTtcblxuICAgIGlmICghc2FtcGxlUmF0ZSB8fCBzYW1wbGVSYXRlIDw9IDApXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc2FtcGxlUmF0ZSB2YWx1ZSAoMCkgZm9yIGJpcXVhZCcpO1xuXG4gICAgdGhpcy5fY2FsY3VsYXRlQ29lZnMoKTtcbiAgICB0aGlzLnByb3BhZ2F0ZVN0cmVhbVBhcmFtcygpO1xuICB9XG5cbiAgLyoqIEBwcml2YXRlICovXG4gIHByb2Nlc3NWZWN0b3IoZnJhbWUpIHtcbiAgICBjb25zdCBmcmFtZVNpemUgPSB0aGlzLnN0cmVhbVBhcmFtcy5mcmFtZVNpemU7XG4gICAgY29uc3Qgb3V0RGF0YSA9IHRoaXMuZnJhbWUuZGF0YTtcbiAgICBjb25zdCBpbkRhdGEgPSBmcmFtZS5kYXRhO1xuICAgIGNvbnN0IHN0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBjb2VmcyA9IHRoaXMuY29lZnM7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZyYW1lU2l6ZTsgaSsrKSB7XG4gICAgICBjb25zdCB4ID0gaW5EYXRhW2ldO1xuICAgICAgY29uc3QgeSA9IGNvZWZzLmIwICogeFxuICAgICAgICAgICAgICArIGNvZWZzLmIxICogc3RhdGUueDFbaV0gKyBjb2Vmcy5iMiAqIHN0YXRlLngyW2ldXG4gICAgICAgICAgICAgIC0gY29lZnMuYTEgKiBzdGF0ZS55MVtpXSAtIGNvZWZzLmEyICogc3RhdGUueTJbaV07XG5cbiAgICAgIG91dERhdGFbaV0gPSB5O1xuXG4gICAgICAvLyB1cGRhdGUgc3RhdGVzXG4gICAgICBzdGF0ZS54MltpXSA9IHN0YXRlLngxW2ldO1xuICAgICAgc3RhdGUueDFbaV0gPSB4O1xuICAgICAgc3RhdGUueTJbaV0gPSBzdGF0ZS55MVtpXTtcbiAgICAgIHN0YXRlLnkxW2ldID0geTtcbiAgICB9XG4gIH1cblxuICAvKiogQHByaXZhdGUgKi9cbiAgcHJvY2Vzc1NpZ25hbChmcmFtZSkge1xuICAgIGNvbnN0IGZyYW1lU2l6ZSA9IHRoaXMuc3RyZWFtUGFyYW1zLmZyYW1lU2l6ZTtcbiAgICBjb25zdCBvdXREYXRhID0gdGhpcy5mcmFtZS5kYXRhO1xuICAgIGNvbnN0IGluRGF0YSA9IGZyYW1lLmRhdGE7XG4gICAgY29uc3Qgc3RhdGUgPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvZWZzID0gdGhpcy5jb2VmcztcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZnJhbWVTaXplOyBpKyspIHtcbiAgICAgIGNvbnN0IHggPSBpbkRhdGFbaV07XG4gICAgICBjb25zdCB5ID0gY29lZnMuYjAgKiB4XG4gICAgICAgICAgICAgICsgY29lZnMuYjEgKiBzdGF0ZS54MSArIGNvZWZzLmIyICogc3RhdGUueDJcbiAgICAgICAgICAgICAgLSBjb2Vmcy5hMSAqIHN0YXRlLnkxIC0gY29lZnMuYTIgKiBzdGF0ZS55MjtcblxuICAgICAgb3V0RGF0YVtpXSA9IHk7XG5cbiAgICAgIC8vIHVwZGF0ZSBzdGF0ZXNcbiAgICAgIHN0YXRlLngyID0gc3RhdGUueDE7XG4gICAgICBzdGF0ZS54MSA9IHg7XG4gICAgICBzdGF0ZS55MiA9IHN0YXRlLnkxO1xuICAgICAgc3RhdGUueTEgPSB5O1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBCaXF1YWQ7XG4iXX0=