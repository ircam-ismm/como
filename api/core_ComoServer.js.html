<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>core/ComoServer.js - como</title>
    
    <meta name="description" content="Documentation of the como framework" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/overrides.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="icon" href="/como/favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    
        <h2 class="home">
            <a href="index.html" style="background-image: url('/como/logo-200x200.png')">
                Home
            </a>
        </h2>
    <h2><a href="../" class="menu-item" >Website</a></h2><h2><a href="https://github.com/ircam-ismm/como" target="_blank" class="menu-item" >Github</a></h2><h3>Classes</h3><ul><li><a href="ComoClient.html">ComoClient</a><ul class='members'><li data-type='member' style='display: none;'><a href="ComoClient.html#audioBufferLoader">audioBufferLoader</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#audioContext">audioContext</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#audioScheduler">audioScheduler</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#components">components</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#host">host</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#id">id</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#nodeId">nodeId</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#playerManager">playerManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#pluginManager">pluginManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#projectManager">projectManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#role">role</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#runtime">runtime</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#scheduler">scheduler</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#scriptManager">scriptManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#sessionManager">sessionManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#soundbankManager">soundbankManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#sourceManager">sourceManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#stateManager">stateManager</a></li><li data-type='member' style='display: none;'><a href="ComoClient.html#store">store</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ComoClient.html#init">init</a></li><li data-type='method' style='display: none;'><a href="ComoClient.html#requestRfc">requestRfc</a></li><li data-type='method' style='display: none;'><a href="ComoClient.html#setProject">setProject</a></li><li data-type='method' style='display: none;'><a href="ComoClient.html#setRfcHandler">setRfcHandler</a></li><li data-type='method' style='display: none;'><a href="ComoClient.html#setRfcResolverHook">setRfcResolverHook</a></li><li data-type='method' style='display: none;'><a href="ComoClient.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ComoClient.html#stop">stop</a></li></ul></li><li><a href="ComoNode.html">ComoNode</a><ul class='members'><li data-type='member' style='display: none;'><a href="ComoNode.html#audioBufferLoader">audioBufferLoader</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#audioContext">audioContext</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#audioScheduler">audioScheduler</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#components">components</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#host">host</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#id">id</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#nodeId">nodeId</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#pluginManager">pluginManager</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#role">role</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#runtime">runtime</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#scheduler">scheduler</a></li><li data-type='member' style='display: none;'><a href="ComoNode.html#stateManager">stateManager</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ComoNode.html#init">init</a></li><li data-type='method' style='display: none;'><a href="ComoNode.html#requestRfc">requestRfc</a></li><li data-type='method' style='display: none;'><a href="ComoNode.html#setProject">setProject</a></li><li data-type='method' style='display: none;'><a href="ComoNode.html#setRfcHandler">setRfcHandler</a></li><li data-type='method' style='display: none;'><a href="ComoNode.html#setRfcResolverHook">setRfcResolverHook</a></li><li data-type='method' style='display: none;'><a href="ComoNode.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ComoNode.html#stop">stop</a></li></ul></li><li><a href="ComoServer.html">ComoServer</a><ul class='members'><li data-type='member' style='display: none;'><a href="ComoServer.html#audioBufferLoader">audioBufferLoader</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#audioContext">audioContext</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#audioScheduler">audioScheduler</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#components">components</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#host">host</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#id">id</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#nodeId">nodeId</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#playerManager">playerManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#pluginManager">pluginManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#projectManager">projectManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#role">role</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#runtime">runtime</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#scheduler">scheduler</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#scriptManager">scriptManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#sessionManager">sessionManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#soundbankManager">soundbankManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#sourceManager">sourceManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#stateManager">stateManager</a></li><li data-type='member' style='display: none;'><a href="ComoServer.html#store">store</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ComoServer.html#init">init</a></li><li data-type='method' style='display: none;'><a href="ComoServer.html#requestRfc">requestRfc</a></li><li data-type='method' style='display: none;'><a href="ComoServer.html#setProject">setProject</a></li><li data-type='method' style='display: none;'><a href="ComoServer.html#setRfcHandler">setRfcHandler</a></li><li data-type='method' style='display: none;'><a href="ComoServer.html#setRfcResolverHook">setRfcResolverHook</a></li><li data-type='method' style='display: none;'><a href="ComoServer.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ComoServer.html#stop">stop</a></li></ul></li><li><a href="SourceManagerServer.html">SourceManagerServer</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">core/ComoServer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import path from 'node:path';
import fs from 'node:fs';
import fsPromises from 'node:fs/promises';

import ServerPluginPlatformInit from '@soundworks/plugin-platform-init/server.js';
import ServerPluginSync from '@soundworks/plugin-sync/server.js';
import { isString } from '@ircam/sc-utils';

import ComoNode from './ComoNode.js';

import globalDescription from './entities/global-description.js';
import projectDescription from './entities/project-description.js';
import nodeDescription from './entities/node-description.js';
import rfcDescription from './entities/rfc-description.js';

import SourceManagerServer from '../components/source-manager/SourceManagerServer.js';
import ProjectManagerServer from '../components/project-manager/ProjectManagerServer.js';
import ScriptManagerServer from '../components/script-manager/ScriptManagerServer.js';
import SoundbankManagerServer from '../components/soundbank-manager/SoundbankManagerServer.js';
import SessionManagerServer from '../components/session-manager/SessionManagerServer.js';
import PlayerManagerServer from '../components/player-manager/PlayerManagerServer.js';

import KeyValueStoreServer from '../components/key-value-store/KeyValueStoreServer.js';

/**
 * Server-side representation of a ComoNode
 *
 * @extends ComoNode
 * @example
 * import { Server } from '@soundworks/core/server.js';
 * import { ComoServer } from '@ircam/como/server.js';
 *
 * const server = new Server(config);
 * const como = new ComoServer(server);
 * await como.start();
 */
class ComoServer extends ComoNode {
  #projectsDirname;

  /**
   * Constructs a new ComoServer instance
   *
   * @param {Server} server - Instance of soundworks server
   * @param {Object} options
   * @param {String} [options.projectsDirname='projects'] - Directory in which the projects live (unstable)
   */
  constructor(server, {
    // directory
    projectsDirname = 'projects',
  } = {}) {
    super(server, { projectsDirname });

    this.#projectsDirname = projectsDirname

    this.pluginManager.register('platform-init', ServerPluginPlatformInit);
    this.pluginManager.register('sync', ServerPluginSync);

    // register global shared states class descriptions
    this.stateManager.defineClass('como:global', globalDescription);
    this.stateManager.defineClass('como:project', projectDescription);
    this.stateManager.defineClass('como:node', nodeDescription);
    this.stateManager.defineClass('como:rfc', rfcDescription);

    /**
     * @member sourceManager
     * @memberof ComoServer#
     * @readonly
     * @type {SourceManagerServer}
     */
    new SourceManagerServer(this, 'sourceManager');
    /**
     * @member projectManager
     * @memberof ComoServer#
     * @readonly
     * @type {ProjectManagerServer}
     */
    new ProjectManagerServer(this, 'projectManager');
    /**
     * @member scriptManager
     * @memberof ComoServer#
     * @readonly
     * @type {ScriptManagerServer}
     */
    new ScriptManagerServer(this, 'scriptManager');
    /**
     * @member soundbankManager
     * @memberof ComoServer#
     * @readonly
     * @type {SoundbankManagerServer}
     */
    new SoundbankManagerServer(this, 'soundbankManager');
    /**
     * @member sessionManager
     * @memberof ComoServer#
     * @readonly
     * @type {SessionManagerServer}
     */
    new SessionManagerServer(this, 'sessionManager');
    /**
     * @member playerManager
     * @memberof ComoServer#
     * @readonly
     * @type {PlayerManagerServer}
     */
    new PlayerManagerServer(this, 'playerManager');
    /**
     * @member store
     * @memberof ComoServer#
     * @readonly
     * @type {KeyValueStoreServer}
     */
    new KeyValueStoreServer(this, 'store');

    this.setRfcHandler('como:setProject', this.#setProject);
  }

  async start() {
    await super.start();
    await this.audioContext.resume();
  }

  #setProject = async ({ projectDirname }) => {
    // allow to go to idle state
    if (projectDirname === null) {
      await this.project.set({ name: null, dirname: null });
    } else {
      if (!isString(projectDirname)) {
        throw new Error(`Cannot execute "setProject" on ComoServer: project directory (${projectDirname}) is not a string`);
      }

      if (!fs.existsSync(projectDirname)) {
        throw new Error(`Cannot execute "setProject" on ComoServer: project directory (${projectDirname}) does not exists`);
      }

      const infosPathname = path.join(projectDirname, this.constants.PROJECT_INFOS_FILENAME);

      if (!fs.existsSync(infosPathname)) {
        throw new Error(`Cannot execute "setProject" on ComoServer: project directory (${projectDirname}) does not contain a ${this.constants.PROJECT_INFOS_FILENAME} file`);
      }

      let infos;

      try {
        const blob = await fsPromises.readFile(infosPathname);
        infos = JSON.parse(blob.toString());
      } catch (err) {
        throw new Error(`Cannot execute "setProject" on ComoServer: ${err.message}`);
      }

      await this.project.set({
        name: infos.name,
        dirname: projectDirname,
      });
    }

    for (let component of this.components.values()) {
      await component.setProject(projectDirname);
    }

    return true;
  }
}

export default ComoServer;
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Mon Feb 09 2026 09:39:50 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
